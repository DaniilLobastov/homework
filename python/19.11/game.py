import sys

bag = []

lamp = False
rustkey = False
neck = False
clockkey = False
clockdone = False

def start():
    print("Вы просыпаетесь в густом, туманном лесу рядом с заброшенным особняком — Усадьба Времени.")
    print("В кармане — записка: «Он остановил ход часов, чтобы скрыть правду. Заведи их снова, если осмелишься...»")
    door()

def door():
    print("\nВы стоите у входа в особняк.")
    print("1. Попытаться открыть парадную дверь")
    print("2. Обойти дом и поискать задний вход")
    print("3. Осмотреть садовый павильон")
    choice = input("> ")
    
    if choice == "1":
        print("Дверь заперта. Нужно найти ключ.")
        door()
    elif choice == "2":
        print("Вы обходите дом, но ничего интересного не находите.")
        door()
    elif choice == "3":
        print("Вы находите ржавый ключ и записку садовника.")
        bag.append("ржавый ключ")
        global rustkey
        rustkey = True
        hall()
    else:
        print("Некорректный выбор.")
        door()

def hall():
    print("\nВы в холле особняка. В центре — огромные стоячие часы, стрелки замерли на 3:15.")
    print("1. Попытаться завести часы")
    print("2. Подняться по лестнице в жилые комнаты")
    print("3. Спуститься в погреб")
    choice = input("> ")

    if choice == "1":
        if clockkey:
            startclock()
        else:
            print("Без ключа завести часы нельзя. Раздаётся громкий бой — кто-то услышал вас!")
            hall()
    elif choice == "2":
        up()
    elif choice == "3":
        down()
    else:
        print("Некорректный выбор.")
        hall()

def up():
    print("\nВы находитесь на верхнем этаже. Можно исследовать комнаты.")
    print("1. Кабинет хозяина")
    print("2. Детская")
    print("3. Библиотека")
    print("4. Вернуться в холл")
    choice = input("> ")

    if choice == "1":
        print("Вы нашли дневник хозяина и ключ от часов в потайном ящике!")
        bag.append("ключ от часов")
        global clockkey
        clockkey = True
        up()
    elif choice == "2":
        print("Вы нашли медальон с портретом девочки.")
        bag.append("медальон")
        global neck
        neck = True
        up()
    elif choice == "3":
        print("Вы нашли обрывок газеты и книги, открывающие потайную комнату.")
        bag.append("обрывок газеты")
        up()
    elif choice == "4":
        hall()
    else:
        print("Некорректный выбор.")
        up()

def down():
    print("\nВы спускаетесь в погреб. Здесь можно найти керосин для фонаря.")
    global lamp
    lamp = True
    bag.append("керосин")
    print("Вы вернулись в холл.")
    hall()

def startclock():
    print("\nВы вставляете ключ в часы и добавляете медальон, чтобы восстановить механизм.")
    global clockdone
    clockdone = True
    end()

def end():
    print("\nВремя начинает течь нормально. Действие приводит к одной из концовок.")
    if clockdone:
        print("Концовка «Искупление»: Часы бьют, Тень успокаивается, души обретают покой. Вы уходите на рассвете.")
    elif "медальон" in bag:
        print("Концовка «Разрыв»: Вы уничтожили кулон. Временная аномалия схлопывается, дом разрушен. Вы выжили, тайна похоронена.")
    else:
        print("Концовка «Поглощение»: Тень настигает вас, и вы становитесь частью временной петли.")
    sys.exit()

start()
